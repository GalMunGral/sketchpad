<!DOCTYPE html>
<canvas
  width="800"
  height="600"
  style="
    box-sizing: border-box;
    max-height: 100%;
    max-width: 100%;
    border: 5px solid black;
  "
></canvas>
<script type="module">
  import { compile } from "./Compiler.js";
  import { run } from "./CPU.js";

  const bin = compile(`
    (INIT frame_buffer 0)
    (INIT alert 0x7fffff)
    (INIT row_size 800)
    (INIT col_size 650)
    (FUNC main () (
      (LOOP 1 (
        (draw 0 0 800 600 255 0 0)
        (draw 0 0 800 600 0 255 0)
        (draw 0 0 800 600 0 0 255)))))
    (FUNC draw (x y w h r g b) (
      (INIT color (| (| (<< r 16) (<< g 8)) b))
      (INIT i y)
      (LOOP (< i (+ y h)) (
        (INIT j x)
        (LOOP (< j (+ x w)) (
          (INIT offset (+ (* i row_size) j))
          (memset frame_buffer offset color)
          (SET j (+ j 1))))
        (SET i (+ i 1))))))
    (FUNC memset (base offset value) (
      (SET base (+ base offset))
      (SET *base value)))
  `);
  console.log(bin);
  run(bin);
</script>
